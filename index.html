<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

    <title>COI</title>
    <script>
    const registerServiceWorker = async () => {
      if ('serviceWorker' in navigator) {
        try {
          // Optional: scope defines which sub-paths the worker controls (default is '/')
          const registration = await navigator.serviceWorker.register('sw.js', {
            scope: '/'
          });
    
          if (registration.installing) {
            console.log('Service worker installing');
          } else if (registration.waiting) {
            console.log('Service worker installed/waiting');
          } else if (registration.active) {
            console.log('Service worker active');
          }
    
        } catch (error) {
          console.error(`Registration failed: ${error}`);
        }
      }
    };
    
    registerServiceWorker();
    </script>
</head>

<body>
    <h1>coi-serviceworker</h1>

    <script type="module">
        const worker = new SharedWorker(new URL('./worker.js', import.meta.url));
        // 2. Start the port (required if using addEventListener)
        worker.port.start();
        // 3. Send a message to the worker
        worker.port.postMessage("Hello from a tab!");
        // 4. Listen for messages from the worker
        worker.port.onmessage = function(e) {
          console.log('Received from worker:', e.data);
        };
        worker.port.onerror = err => console.error('worker', err);
    </script>
    
    <script>
        const el = document.createElement("div")
        el.innerHTML = `Cross origin isolated: ${window.crossOriginIsolated ? "✅" : "❌"}`
        document.body.append(el);
    </script>
</body>

</html>
